/* status-bar v4.0.0-2 | (c) 2016 SorryApp Ltd. | http://www.apache.org/licenses/LICENSE-2.0.html */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){if(a.support.cors||!a.ajaxTransport||!window.XDomainRequest)return a;var b=/^(https?:)?\/\//i,c=/^get|post$/i,d=new RegExp("^(//|"+location.protocol+")","i");return a.ajaxTransport("* text html xml json",function(e,f,g){if(e.crossDomain&&e.async&&c.test(e.type)&&b.test(e.url)&&d.test(e.url)){var h=null;return{send:function(b,c){var d="",g=(f.dataType||"").toLowerCase();h=new XDomainRequest,/^\d+$/.test(f.timeout)&&(h.timeout=f.timeout),h.ontimeout=function(){c(500,"timeout")},h.onload=function(){var b="Content-Length: "+h.responseText.length+"\r\nContent-Type: "+h.contentType,d={code:200,message:"success"},e={text:h.responseText};try{if("html"===g||/text\/html/i.test(h.contentType))e.html=h.responseText;else if("json"===g||"text"!==g&&/\/json/i.test(h.contentType))try{e.json=a.parseJSON(h.responseText)}catch(f){d.code=500,d.message="parseerror"}else if("xml"===g||"text"!==g&&/\/xml/i.test(h.contentType)){var i=new ActiveXObject("Microsoft.XMLDOM");i.async=!1;try{i.loadXML(h.responseText)}catch(f){i=void 0}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw d.code=500,d.message="parseerror","Invalid XML: "+h.responseText;e.xml=i}}catch(j){throw j}finally{c(d.code,d.message,e,b)}},h.onprogress=function(){},h.onerror=function(){c(500,"error",{text:h.responseText})},f.data&&(d="string"===a.type(f.data)?f.data:a.param(f.data)),h.open(e.type,e.url),h.send(d)},abort:function(){h&&h.abort()}}}}),a}),function(a,b){"function"==typeof define&&define.amd?define(["LukesLazyLoader"],b):"object"==typeof module&&module.exports?module.exports=b():a.LukesLazyLoader=b()}(this,function(){function a(a,b){var c=Array.prototype.slice.call(arguments);b=this._isFunction(c[c.length-1])?c.pop():this._noop,this._callbacks=[],this._addCallback(b),this.setFiles(c),this._setBrowserCssOnLoadSupport(),window.setTimeout(this._load.bind(this),0)}return a.load=function(b,c){return new a(b,c)},function(){this._TYPE_CSS="css",this._TYPE_JS="js",this._CSS_REGEX=/(\.css|\.less)/i,this._JS_REGEX=/(\.js|\.es6|\.es|\.jsx)/i,this.setFiles=function(a){var b=a.length;a=Array.isArray(a)?a:Array.prototype.slice.call(arguments),this._files=[];for(var c=0;b>c;c++)this._files.push({url:a[c],loaded:!1});return this},this.then=function(a){return this._addCallback(a),this},this.thenLoad=function(b,c){return this._addToLoadQueue(new a(b,c)),this},this._load=function(){for(var a=this._files.length,b=0;a>b;b++)this._loadFile(this._files[b].url);return this},this._loadFile=function(a){return this._getFileType(a)===this._TYPE_JS&&this._appendScript(a),this._getFileType(a)===this._TYPE_CSS&&this._appendStylesheet(a),this},this._appendScript=function(a){var b=document.createElement("script");return b.type="text/javascript",b.src=a,b.onload=this._getUrlLoadedMethod(a),this._appendToHead(b),this},this._appendStylesheet=function(a){var b=document.createElement("link");return b.href=a,b.rel="stylesheet",b.type="text/css",b.onload=this._getUrlLoadedMethod(a),b.onreadystatechange=this._getOnReadyStateChangeCallback(a),this._appendToHead(b),this._cssOnLoadSupport||this._pollStylesheet(b),this},this._appendToHead=function(a){return document.getElementsByTagName("head")[0].appendChild(a),this},this._getFileType=function(a){return this._JS_REGEX.test(a)?this._TYPE_JS:this._CSS_REGEX.test(a)?this._TYPE_CSS:null},this._getOnReadyStateChangeCallback=function(a){var b=this;return function(){["loaded","complete"].indexOf(this.readyState)>-1&&b._setLoaded(a)}},this._getUrlLoadedMethod=function(a){return function(){this._setLoaded(a)}.bind(this)},this._pollStylesheet=function(a){try{a.cssRules||a.rules&&a.rules.length?this._setLoaded(a.getAttribute("href")):setTimeout(function(){this._pollStylesheet(a)}.bind(this),200)}catch(b){setTimeout(function(){this._pollStylesheet(a)}.bind(this),200)}return this},this._setLoaded=function(a){var b=!0;for(var c in this._files)this._files[c].url===a&&(this._files[c].loaded=!0),b=b&&this._files[c].loaded;return b&&this._invokeCallbacks(),this},this._isFunction=function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},this._setBrowserCssOnLoadSupport=function(){var a=document.createElement("link");return a.href="//foo.css",a.rel="stylesheet",a.type="text/css",a.setAttribute("onload","return;"),this._cssOnLoadSupport="function"==typeof a.onload,this},this._addCallback=function(a){return this._callbacks.push(a),this},this._invokeCallbacks=function(){for(var a=this._callbacks.length,b=0;a>b;b++)this._callbacks[b]();return this},this._noop=function(){}}.call(a.prototype),a}),function(a,b,c,d){"use strict";b.SorryAPI=function(c){var d=this;d.options=a.extend({},SorryAPI.DEFAULTS,b.SorryAPIOptions,c)},SorryAPI.DEFAULTS={host:"https://ro-api.sorryapp.com",version:1},SorryAPI.prototype.endpoint_url=function(){var a=this;return a.options.host+"/v"+a.options.version},SorryAPI.prototype.fetchPage=function(b,c){var d=this,e=d.endpoint_url()+"/pages/"+b;return a.ajax({type:"GET",crossDomain:!0,dataType:"json",url:e,beforeSend:function(a){a.setRequestHeader("X-Plugin-Ping","status-bar")},data:{include:"brand,notices,notices.updates",subscriber:d.options.subscriber},success:c})}}(jQuery,window,document),function(a,b,c,d){"use strict";var e=function(){var a=Raven.noConflict();a.config("https://fe8e83188d1d452d9f56e445a82102b6@app.getsentry.com/74508",{whitelistUrls:[/status\-bar\.min\.js/]}).install()};"undefined"==typeof Raven?new LukesLazyLoader("https://cdn.ravenjs.com/2.3.0/raven.min.js",function(){e()}):e();var f=function(a,b,c){var d=this;d.attributes=b,d.update=c,d.parent=a,d.template='<div class="sorry-status-notice" id="sorry-status-notice-{{id}}" role="alert">			<button type="button" class="sorry-status-notice-close" data-dismiss="status-notice" aria-hidden="true"><i class="sorry-status-notice-icon sorry-status-notice-icon-times-circle"></i></button>						<div class="sorry-status-notice-content">				<h4 class="sorry-status-notice-header"><i class="sorry-status-notice-icon sorry-status-notice-icon-bullhorn"></i> Ongoing</h4>				<p class="sorry-status-notice-text">{{notice}}</p>				<a class="sorry-status-notice-link" href="{{link}}" target="_blank" title="Visit our Status Page for more information.">More &#8594;</a>			</div>		</div>',d.frag="",d.buildFrag()};f.prototype.dismiss=function(a){var c=this;a.preventDefault(),c.parent.dismissed[c.attributes.id]=new Date,b.localStorage.setItem("sorry-status-bar",JSON.stringify(c.parent.dismissed)),c.$elem.remove()},f.prototype.buildFrag=function(){var a=this;a.frag+=a.template.replace(/{{notice}}/gi,a.update.content).replace(/{{link}}/gi,a.attributes.link).replace(/{{id}}/gi,a.attributes.id)},f.prototype.display=function(){var b=this;b.$elem=a(b.frag),b.parent.$elem.prepend(b.$elem),b.$elem.find('[data-dismiss="status-notice"]').bind("click.dismiss.status-notice",a.proxy(this.dismiss,this))};var g=function(c,d){var e=this;e.elem=d,e.$elem=a(d),e.options=c,e.api=new SorryAPI,e.dismissed=JSON.parse(b.localStorage.getItem("sorry-status-bar"))||{}};g.prototype.init=function(){var a=this;a.api.fetchPage(a.options.statusBarFor||a.options["status-bar-for"],function(b){a.loadcss(function(){a.set_style(b.response.brand),a.render(b.response.notices)})})},g.prototype.render=function(b){var c=this,d=a.grep(b,function(a){return"open"==a.state});a.each(d,function(b,d){if(c.dismissed.hasOwnProperty(d.id))a.each(d.updates.reverse(),function(a,b){if(b.created_at>c.dismissed[d.id]){var e=new f(c,d,b);return e.display(),!1}});else{var e=new f(c,d,d.updates[d.updates.length-1]);e.display()}})},g.prototype.set_style=function(b){var c=" 			.sorry-status-bar { 				background-color: {{background_color}};			} 			.sorry-status-notice-header, .sorry-status-notice-text {				color: {{text_color}}; 			}			.sorry-status-notice-link, .sorry-status-notice-link:hover { 				color: {{link_color}}; 			} 			.sorry-status-notice-close, .sorry-status-notice-close:hover { 				color: {{text_color}}; 			} 		",d=b.color_header_background,e=b.color_header_text,f=b.color_header_links,g=b.color_state_warning,h=c.replace(/{{text_color}}/gi,e).replace(/{{background_color}}/gi,d).replace(/{{link_color}}/gi,f).replace(/{{state_warning_color}}/gi,g);a("head").append("<style>"+h+"</style>")},g.prototype.loadcss=function(a){var b=this;new LukesLazyLoader(b.getpath()+"status-bar.min.css",a)},g.prototype.getpath=function(){var b=a('script[src$="status-bar.min.js"]')[0];return b.src.split("?")[0].split("/").slice(0,-1).join("/")+"/"};var h=a.fn.statusBar;a.fn.statusBar=function(b){return this.each(function(){var c=new g(b,this);a.data(this,"statusBar",c)})},a.fn.statusBar.noConflict=function(){return a.fn.statusBar=h,this},a.fn.statusBar.setup=function(){var b=a('script[src$="status-bar.min.js"]')[0].getAttribute("data-for");b&&a(b.split(",")).each(function(){0===a('[data-status-bar-for="'+this+'"]').length&&a("body").prepend('<div class="sorry-status-bar" data-status-bar-for="'+this+'"></div>')})},a(b).bind("load",function(){a.fn.statusBar.setup(),a("[data-status-bar-for]").each(function(){var b=a(this);b.statusBar(b.data()),b.data("statusBar").init()})})}(jQuery,window,document);