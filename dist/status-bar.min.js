/* status-bar v4.0.0-2 | (c) 2016 SorryApp Ltd. | http://www.apache.org/licenses/LICENSE-2.0.html */
!function(a,b){function c(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof a?a=b(jQuery):b(jQuery)}(function(a){if(a.support.cors||!a.ajaxTransport||!window.XDomainRequest)return a;var b=/^(https?:)?\/\//i,c=/^get|post$/i,d=new RegExp("^(//|"+location.protocol+")","i");return a.ajaxTransport("* text html xml json",function(e,f,g){if(e.crossDomain&&e.async&&c.test(e.type)&&b.test(e.url)&&d.test(e.url)){var h=null;return{send:function(b,c){var d="",g=(f.dataType||"").toLowerCase();h=new XDomainRequest,/^\d+$/.test(f.timeout)&&(h.timeout=f.timeout),h.ontimeout=function(){c(500,"timeout")},h.onload=function(){var b="Content-Length: "+h.responseText.length+"\r\nContent-Type: "+h.contentType,d={code:200,message:"success"},e={text:h.responseText};try{if("html"===g||/text\/html/i.test(h.contentType))e.html=h.responseText;else if("json"===g||"text"!==g&&/\/json/i.test(h.contentType))try{e.json=a.parseJSON(h.responseText)}catch(f){d.code=500,d.message="parseerror"}else if("xml"===g||"text"!==g&&/\/xml/i.test(h.contentType)){var i=new ActiveXObject("Microsoft.XMLDOM");i.async=!1;try{i.loadXML(h.responseText)}catch(f){i=void 0}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw d.code=500,d.message="parseerror","Invalid XML: "+h.responseText;e.xml=i}}catch(j){throw j}finally{c(d.code,d.message,e,b)}},h.onprogress=function(){},h.onerror=function(){c(500,"error",{text:h.responseText})},f.data&&(d="string"===a.type(f.data)?f.data:a.param(f.data)),h.open(e.type,e.url),h.send(d)},abort:function(){h&&h.abort()}}}}),a}),function(b){"use strict";var c=function(a,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=b.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=a,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof a?a.loadCSS=c:b.loadCSS=c}("undefined"!=typeof b?b:this),function(b){var c=function(a,c){"use strict";var d=b.document.getElementsByTagName("script")[0],e=b.document.createElement("script");return e.src=a,e.async=!0,d.parentNode.insertBefore(e,d),c&&"function"==typeof c&&(e.onload=c),e};"undefined"!=typeof a?a.loadJS=c:b.loadJS=c}("undefined"!=typeof b?b:this),function(b){"use strict";var c=function(a){var b=this;b.options=$.extend({},c.DEFAULTS,window.SorryAPIOptions,a)};c.DEFAULTS={host:"https://ro-api.sorryapp.com",version:1},c.prototype.endpoint_url=function(){var a=this;return a.options.host+"/v"+a.options.version},c.prototype.fetchPage=function(a,b){var c=this,d=c.endpoint_url()+"/pages/"+a;return $.ajax({type:"GET",crossDomain:!0,dataType:"json",url:d,beforeSend:function(a){a.setRequestHeader("X-Plugin-Ping","status-bar")},data:{include:"brand,notices,notices.updates",subscriber:c.options.subscriber},success:b})},"undefined"!=typeof a?a.SorryAPI=c:b.SorryAPI=c}("undefined"!=typeof b?b:this),function(b,d,e,f){"use strict";var g=function(){var a=Raven.noConflict();a.config("https://fe8e83188d1d452d9f56e445a82102b6@app.getsentry.com/74508",{whitelistUrls:[/status\-bar\.min\.js/]}).install()};"undefined"==typeof Raven?a.loadJS("https://cdn.ravenjs.com/2.3.0/raven.min.js",function(){g()}):g();var h=function(a,b,c){var d=this;d.attributes=b,d.update=c,d.parent=a,d.template='<div class="sorry-status-notice" id="sorry-status-notice-{{id}}" role="alert">			<button type="button" class="sorry-status-notice-close" data-dismiss="status-notice" aria-hidden="true"><i class="sorry-status-notice-icon sorry-status-notice-icon-times-circle"></i></button>						<div class="sorry-status-notice-content">				<h4 class="sorry-status-notice-header"><i class="sorry-status-notice-icon sorry-status-notice-icon-bullhorn"></i> Ongoing</h4>				<p class="sorry-status-notice-text">{{notice}}</p>				<a class="sorry-status-notice-link" href="{{link}}" target="_blank" title="Visit our Status Page for more information.">More &#8594;</a>			</div>		</div>',d.frag="",d.buildFrag()};h.prototype.dismiss=function(a){var b=this;a.preventDefault(),b.parent.dismissed[b.attributes.id]=new Date,d.localStorage.setItem("sorry-status-bar",JSON.stringify(b.parent.dismissed)),b.$elem.remove()},h.prototype.buildFrag=function(){var a=this;a.frag+=a.template.replace(/{{notice}}/gi,a.update.content).replace(/{{link}}/gi,a.attributes.link).replace(/{{id}}/gi,a.attributes.id)},h.prototype.display=function(){var a=this;a.$elem=b(a.frag),a.parent.$elem.prepend(a.$elem),a.$elem.find('[data-dismiss="status-notice"]').bind("click.dismiss.status-notice",b.proxy(this.dismiss,this))};var i=function(c,e){var f=this;f.elem=e,f.$elem=b(e),f.options=c,f.api=new a.SorryAPI,f.dismissed=JSON.parse(d.localStorage.getItem("sorry-status-bar"))||{}};i.prototype.init=function(){var a=this;a.api.fetchPage(a.options.statusBarFor||a.options["status-bar-for"],function(b){a.loadcss(function(){a.set_style(b.response.brand),a.render(b.response.notices)})})},i.prototype.render=function(a){var c=this,d=b.grep(a,function(a){return"open"==a.state});b.each(d,function(a,d){if(c.dismissed.hasOwnProperty(d.id))b.each(d.updates.reverse(),function(a,b){if(b.created_at>c.dismissed[d.id]){var e=new h(c,d,b);return e.display(),!1}});else{var e=new h(c,d,d.updates[d.updates.length-1]);e.display()}})},i.prototype.set_style=function(a){var c=" 			.sorry-status-bar { 				background-color: {{background_color}};			} 			.sorry-status-notice-header, .sorry-status-notice-text {				color: {{text_color}}; 			}			.sorry-status-notice-link, .sorry-status-notice-link:hover { 				color: {{link_color}}; 			} 			.sorry-status-notice-close, .sorry-status-notice-close:hover { 				color: {{text_color}}; 			} 		",d=a.color_header_background,e=a.color_header_text,f=a.color_header_links,g=a.color_state_warning,h=c.replace(/{{text_color}}/gi,e).replace(/{{background_color}}/gi,d).replace(/{{link_color}}/gi,f).replace(/{{state_warning_color}}/gi,g);b("head").append("<style>"+h+"</style>")},i.prototype.loadcss=function(d){var e=this,f=b("head").children.last;b("link").length&&(f=b(b("link")[0]));var g=a.loadCSS(e.getpath()+"status-bar.min.css",f[0]);c(g,d)},i.prototype.getpath=function(){var a=b('script[src$="status-bar.min.js"]')[0];return a.src.split("?")[0].split("/").slice(0,-1).join("/")+"/"};var j=b.fn.statusBar;b.fn.statusBar=function(a){return this.each(function(){var c=new i(a,this);b.data(this,"statusBar",c)})},b.fn.statusBar.noConflict=function(){return b.fn.statusBar=j,this},b.fn.statusBar.setup=function(){var a=b('script[src$="status-bar.min.js"]')[0].getAttribute("data-for");a&&b(a.split(",")).each(function(){0===b('[data-status-bar-for="'+this+'"]').length&&b("body").prepend('<div class="sorry-status-bar" data-status-bar-for="'+this+'"></div>')})},b(d).bind("load",function(){b.fn.statusBar.setup(),b("[data-status-bar-for]").each(function(){var a=b(this);a.statusBar(a.data()),a.data("statusBar").init()})})}(jQuery,window,document),b["true"]=a}({},function(){return this}());
//# sourceMappingURL=status-bar.min.js.map